<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/5408110.js"></script><script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5BSW555');
      </script><script>
      (function() {
        var routes = {"/almacare":"/enterprise-support-for-almalinux/","/service-descriptions/#almacare":"/enterprise-support-for-almalinux/#essential-and-enhanced-support","/eportal/#almacare-cybersecurity-patch-management":"/eportal/#live-patching-for-almalinux-kernelcare-and-libcare-management","/eportal/#deploying-almacare-almacare-cybersecurity":"/eportal/#deploying-essential-support-live-patching-for-almalinux","/endless-lifecycle-support-for-languages/":"/els-for-languages/","/endless-lifecycle-support-for-languages":"/els-for-languages","/endless-lifecycle-support":"/els-for-os","/endless-lifecycle-support/":"/els-for-os/"};
    
        for (var route_url in routes) {
          if (window.location.href.indexOf(route_url) !== -1) {
            window.location.href = routes[route_url];
          }
        }
      })();
      </script><script>
                    (function() {
                      // Trigger the scroll event without actually scrolling
                      function triggerScrollEvent() {
                        const targetElement = window;
                        const scrollEvent = new Event('scroll', {
                          bubbles: true,
                          cancelable: true,
                        });
                        targetElement.dispatchEvent(scrollEvent);
                      }
              
                      // Call the triggerScrollEvent and scrollBodyDown functions after the page is fully loaded
                      window.addEventListener('load', () => {
                        triggerScrollEvent();
                      });
                    })();
                  </script><title>ePortal</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-6195e872.css" as="style"><link rel="stylesheet" href="/assets/style-6195e872.css">
    <link rel="modulepreload" href="/assets/app-6db1f508.js"><link rel="modulepreload" href="/assets/framework-1d7fbccb.js"><link rel="modulepreload" href="/assets/index.html-d168ea36.js"><link rel="modulepreload" href="/assets/index.html-86288f4f.js"><link rel="modulepreload" href="/assets/sso_eportal-e50a2693.js"><link rel="modulepreload" href="/assets/eportal-qemu-feed-7c9efdb9.js"><link rel="prefetch" href="/assets/index.html-2c57371e.js" as="script"><link rel="prefetch" href="/assets/index.html-f4bbd787.js" as="script"><link rel="prefetch" href="/assets/index.html-550a0ffa.js" as="script"><link rel="prefetch" href="/assets/index.html-ea680e2b.js" as="script"><link rel="prefetch" href="/assets/index.html-1ca25907.js" as="script"><link rel="prefetch" href="/assets/index.html-092f14d9.js" as="script"><link rel="prefetch" href="/assets/index.html-e1c111f0.js" as="script"><link rel="prefetch" href="/assets/index.html-a67c3dff.js" as="script"><link rel="prefetch" href="/assets/index.html-cea51d54.js" as="script"><link rel="prefetch" href="/assets/index.html-d5e6f75c.js" as="script"><link rel="prefetch" href="/assets/index.html-c5914df6.js" as="script"><link rel="prefetch" href="/assets/index.html-448a5efa.js" as="script"><link rel="prefetch" href="/assets/index.html-6c9650cc.js" as="script"><link rel="prefetch" href="/assets/index.html-55653af3.js" as="script"><link rel="prefetch" href="/assets/index.html-e7ada822.js" as="script"><link rel="prefetch" href="/assets/index.html-e56cdeb6.js" as="script"><link rel="prefetch" href="/assets/index.html-d924646e.js" as="script"><link rel="prefetch" href="/assets/index.html-71fb4d10.js" as="script"><link rel="prefetch" href="/assets/index.html-bfb306f5.js" as="script"><link rel="prefetch" href="/assets/index.html-04265117.js" as="script"><link rel="prefetch" href="/assets/index.html-c09eba5b.js" as="script"><link rel="prefetch" href="/assets/index.html-45ca0bbf.js" as="script"><link rel="prefetch" href="/assets/index.html-070c63b3.js" as="script"><link rel="prefetch" href="/assets/index.html-270136ce.js" as="script"><link rel="prefetch" href="/assets/index.html-e424f433.js" as="script"><link rel="prefetch" href="/assets/404.html-e0575d4e.js" as="script"><link rel="prefetch" href="/assets/index.html-0c564990.js" as="script"><link rel="prefetch" href="/assets/index.html-d0951403.js" as="script"><link rel="prefetch" href="/assets/index.html-c0e24f27.js" as="script"><link rel="prefetch" href="/assets/index.html-533f1557.js" as="script"><link rel="prefetch" href="/assets/index.html-8d714e25.js" as="script"><link rel="prefetch" href="/assets/index.html-545037f1.js" as="script"><link rel="prefetch" href="/assets/index.html-898bd75f.js" as="script"><link rel="prefetch" href="/assets/index.html-a76f049a.js" as="script"><link rel="prefetch" href="/assets/index.html-55a10882.js" as="script"><link rel="prefetch" href="/assets/index.html-f65480cd.js" as="script"><link rel="prefetch" href="/assets/index.html-84bb6b1c.js" as="script"><link rel="prefetch" href="/assets/index.html-e01e18a6.js" as="script"><link rel="prefetch" href="/assets/index.html-6dc29dbe.js" as="script"><link rel="prefetch" href="/assets/index.html-f9388cc5.js" as="script"><link rel="prefetch" href="/assets/index.html-79310cf4.js" as="script"><link rel="prefetch" href="/assets/index.html-53a79655.js" as="script"><link rel="prefetch" href="/assets/index.html-6ceae193.js" as="script"><link rel="prefetch" href="/assets/index.html-5c5de709.js" as="script"><link rel="prefetch" href="/assets/index.html-108ff0a0.js" as="script"><link rel="prefetch" href="/assets/index.html-3bedd205.js" as="script"><link rel="prefetch" href="/assets/index.html-2089bcfd.js" as="script"><link rel="prefetch" href="/assets/index.html-cd78c957.js" as="script"><link rel="prefetch" href="/assets/index.html-52bc367a.js" as="script"><link rel="prefetch" href="/assets/index.html-db0f5c94.js" as="script"><link rel="prefetch" href="/assets/index.html-a8c1162b.js" as="script"><link rel="prefetch" href="/assets/404.html-f7b8d086.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar fixed"><div class="navbar-header"><div class="navbar-header__logo-wrapper"><a href="/" class="home-link"><img class="logo" src="/global/logo.svg" alt="logo header"></a><div class="header-layout__search-container header-mobile__hidden"><!----><form id="search-form" class="drawer-header__input"><input type="text" value="" id="algolia-search-input" placeholder="Search" class="header-layout__search-default" maxlength="100"><div class="header-layout__search-icon-default"><img alt="search icon" src="/global/search.svg"><!----></div></form><div><div class="drawer"><div class="drawer-header"><div class="drawer-header__wrapper"><h2 class="drawer-header__paragraph">How can we help you?</h2><div id="drawerSearch"></div></div><div class="drawer-cross"><img class="drawer-cross__img" src="/global/cross.svg" alt="cross"><p class="drawer-cross__text">close</p></div></div><main><div class="drawer-main"><div class="drawer-main__wrapper"><div class="drawer-main__breadcrumb"><!-- Optional breadcrumb can stay here --></div><div><p class="no_results">Please type your search query, then press Enter or click the search button.</p></div></div></div><!----></main></div><!----></div></div></div><div class="links" style="max-width:nullpx;"><img class="navbar-header__mobile-search" src="/global/search.svg" alt="icon image"><div class="header-products-wrapper"><div class="dropdown"><!----><!----><div class="header-products-container"><img class="header-products-container__img" alt="hamburger menu" src="/global/hamburger-menu.svg"><p class="header-products-wrapper-paragraph">Products</p><img class="products-icon__default" width="10" height="8" src="/arrows/arrow-down.svg" alt="arrow down icon"></div></div></div><!--[--><a href="https://www.tuxcare.com/support-portal/" target="_blank" class="btn">Submit support request</a><a href="https://features.tuxcare.com/submit-idea/" target="_blank" class="btn">Submit your idea</a><!--]--></div></div><!----></header><!----><div class="page"><!--[--><!--]--><div class="breadcrumb-wrapper page-breadcrumb" data-v-9445381a><span class="breadcrumb-title" data-v-9445381a>Documentation:</span><!--[--><a aria-current="page" href="/eportal/" class="router-link-active router-link-exact-active breadcrumb" data-v-9445381a>ePortal</a><!--]--></div><img class="page-mobile__sidebar-menu" src="/global/sidebar-menu.svg" alt="sidebar hamburger menu"><div class="page-nav-wrapper"><!----></div><div class="content" custom="false"><!-- markdownlint-disable MD014 MD033 MD029 MD049 MD034 MD051--><h1 id="eportal" tabindex="-1"><a class="header-anchor" href="#eportal" aria-hidden="true">#</a> ePortal</h1><p>TuxCare ePortal is the web management console dedicated to KernelCare Enterprise live patch management.</p><p>ePortal software can help protect servers located behind the firewall (i.e. with no internet access) and can be installed both on-premises and in the cloud.</p><p><img src="/images/eportal-overview.svg" alt="Overview"></p><h2 id="eportal-hardware-requirements" tabindex="-1"><a class="header-anchor" href="#eportal-hardware-requirements" aria-hidden="true">#</a> ePortal Hardware Requirements</h2><p><strong>Disk:</strong></p><ul><li>100 GB minimum, 200 GB recommended (20GB in case of cache mode)</li><li>SSD with at least 100 IOPS</li></ul><div class="tip custom-block"><p class="custom-block-title">Note</p><p>SSD based storage is a crucial requirement for ePortal server.</p></div><p><strong>CPU:</strong></p><p>As far as other requirements concerned, we have tested the following configuration and the following number of connected servers:</p><ul><li><p>10k of connected machines is the maximum for the following requirements:</p><ul><li>VM</li><li>1 VCPU</li><li>1 GB RAM</li></ul></li><li><p>75k of connected machines is the maximum for the following requirements:</p><ul><li>Core i5</li><li>1 CPU</li><li>4 GB RAM</li></ul></li></ul><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation" aria-hidden="true">#</a> Installation</h2><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you are installing for the first time, please confirm with our sales engineering team at <a href="sales@tuxcare.com">sales@tuxcare.com</a> <strong>BEFORE</strong> trying the installation via the documentation below. Please note that support tickets resulting from not following this recommendation will not be accepted.</p></div><p>ePortal is compatible with 64-bit versions of EL7/8/9 based distros like CentOS 7/8, AlmaLinux 8/9, Ubuntu 20.04/22.04/24.04 and Debian 11/12</p><h3 id="rhel-based-distros" tabindex="-1"><a class="header-anchor" href="#rhel-based-distros" aria-hidden="true">#</a> RHEL-based distros</h3><p>For installation and workability of ePortal the Nginx web server is required. We recommend to use stable version from the official Nginx repository:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># cat &gt; /etc/yum.repos.d/nginx.repo &lt;&lt;EOL
[nginx]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can find more information at <a href="https://nginx.org/en/linux_packages.html#stable" target="_blank" rel="noopener noreferrer">https://nginx.org/en/linux_packages.html#stable</a></p><p>Setup ePortal repo:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># cat &gt; /etc/yum.repos.d/kcare-eportal.repo &lt;&lt;EOL
[kcare-eportal]
name=KernelCare ePortal
baseurl=https://www.repo.cloudlinux.com/kcare-eportal/\$releasever/\$basearch/
enabled=1
gpgkey=https://repo.cloudlinux.com/kernelcare/RPM-GPG-KEY-KernelCare
gpgcheck=1
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you are using CentOS7, starting from ePortal version 2.4-2, it&#39;s necessary to install the <code>centos-release-scl</code> package. You can do so with the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># yum install centos-release-scl
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For RHEL7 users, you&#39;ll need to enable the necessary repositories to ensure access to the required packages. Use the subscription-manager utility with the following commands:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># subscription-manager repos --enable rhel-7-server-optional-rpms
# subscription-manager repos --enable rhel-server-rhscl-7-rpms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>For Oracle Linux 7 users, similar to CentOS7, you need to install the oracle-softwarecollection-release-el7 package. This can be done using the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># yum install oracle-softwarecollection-release-el7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><p>Install ePortal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># yum install -y kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ubuntu-20-04" tabindex="-1"><a class="header-anchor" href="#ubuntu-20-04" aria-hidden="true">#</a> Ubuntu 20.04</h3><p>Setup ePortal repo:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends curl ca-certificates

# curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

# cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/20.04 focal main
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Install ePortal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ubuntu-22-04" tabindex="-1"><a class="header-anchor" href="#ubuntu-22-04" aria-hidden="true">#</a> Ubuntu 22.04</h3><p>Setup ePortal repo:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends curl ca-certificates

# curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

# cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/22.04 jammy main
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Install ePortal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ubuntu-24-04" tabindex="-1"><a class="header-anchor" href="#ubuntu-24-04" aria-hidden="true">#</a> Ubuntu 24.04</h3><p>Setup ePortal repo:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends curl ca-certificates

# curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

# cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/24.04 noble main
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Install ePortal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="debian-11" tabindex="-1"><a class="header-anchor" href="#debian-11" aria-hidden="true">#</a> Debian 11</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends curl ca-certificates

# curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

# cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/debian/11 kcare main
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Install ePortal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="debian-12" tabindex="-1"><a class="header-anchor" href="#debian-12" aria-hidden="true">#</a> Debian 12</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends curl ca-certificates

# curl https://repo.cloudlinux.com/kernelcare/kernelcare.gpg -o /usr/share/keyrings/kcare-eportal.gpg

# cat &gt; /etc/apt/sources.list.d/kcare-eportal.list &lt;&lt;EOL
deb [signed-by=/usr/share/keyrings/kcare-eportal.gpg] https://repo.cloudlinux.com/kcare-eportal/debian/12 kcare main
EOL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Install ePortal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># apt update &amp;&amp; apt install -y --no-install-recommends kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="allowed-hosts" tabindex="-1"><a class="header-anchor" href="#allowed-hosts" aria-hidden="true">#</a> Allowed hosts</h2><p>We must declare the list of allowed hosts in the configuration for security reasons. It help to avoid HTTP Host header attacks. According to your installation, you need to add this parameter into <a href="#config-files">ePortal config file</a>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ALLOWED_HOSTS = [&#39;node1-yourdomain.example.com&#39;, &#39;node2-yourdomain.example.com&#39;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Instead of an example, use the DNS name(s) of your ePortal server installation. Default value is <code>[]</code>.</p><h2 id="cache-mode" tabindex="-1"><a class="header-anchor" href="#cache-mode" aria-hidden="true">#</a> Cache mode</h2><p>Cache mode allows to greatly reduce disk usage requirements and speed up initial downloading step.</p><p>In cache mode ePortal downloads only lightweight meta information about patchsets and proxies patch requests from KernelCare agent to the patch server (Patch Source). Downloaded patch binaries are cached for 2 weeks and accessible for following requests directly from ePortal and doesn&#39;t consume public internet bandwidth.</p><p><img src="/images/eportal-cache-mode.svg" alt="Cache mode"></p><h3 id="enable-cache-mode" tabindex="-1"><a class="header-anchor" href="#enable-cache-mode" aria-hidden="true">#</a> Enable cache mode</h3><ol><li>add the following setting into the <a href="#config-files">ePortal config file</a>:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CACHE_MODE = True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>restart ePortal:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># systemctl restart eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For existing installations you have to refetch meta info for existing patchsets:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kcare/kc.eportal cache-mode --fetch-meta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="disable-cache-mode" tabindex="-1"><a class="header-anchor" href="#disable-cache-mode" aria-hidden="true">#</a> Disable cache mode</h3><ol><li>remove or comment the line below in the <a href="#config-files">ePortal config file</a>:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CACHE_MODE = True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="2"><li>download missing patchests:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kcare/kc.eportal kcare download-missing
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>restart ePortal:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># systemctl restart eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="proxy-configuration" tabindex="-1"><a class="header-anchor" href="#proxy-configuration" aria-hidden="true">#</a> Proxy configuration</h2><p>ePortal can fetch packages and patches via a customer&#39;s proxy server.</p><p><img src="/images/eportal-with-proxy.svg" alt="Proxy"></p><p>On the ePortal machine, you should define the same proxy settings as you use on the command line.</p><p>To do so, add <code>PROXY = &#39;http://example.com:3128&#39;</code> into the <a href="#config-files">ePortal config file</a>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># echo &quot;PROXY = &#39;http://example.com:3128&#39;&quot; &gt;&gt; /etc/eportal/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ePortal also supports a SOCKS5 proxy via <code>socks5://</code> proxy scheme:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># echo &quot;PROXY = &#39;socks5://example.com:1080&#39;&quot; &gt;&gt; /etc/eportal/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Restart ePortal (see the <a href="#stopping-starting">Stopping &amp; Starting</a> section, choose a corresponding OS).</p><h2 id="auth-configuration" tabindex="-1"><a class="header-anchor" href="#auth-configuration" aria-hidden="true">#</a> Auth configuration</h2><table><thead><tr><th>Setting</th><th>Description</th></tr></thead><tbody><tr><td><code>AUTH_RESTRICTED_INDEX</code></td><td>Allow access to the index page only for registered users</td></tr><tr><td><code>AUTH_PASSWORD_MIN_LENGTH</code></td><td>Minimal password length, default 5</td></tr><tr><td><code>AUTH_SESSION_LIFETIME</code></td><td>Session lifetime in seconds, by default session will last till browser closing</td></tr><tr><td><code>AUTH_REFRESH_SESSION</code></td><td>If <code>False</code> (default), expires session after lifetime seconds after login. If <code>True</code>, expires session after lifetime seconds of inactivity.</td></tr></tbody></table><p>You can set configuration in <a href="#config-files">ePortal config file</a>.</p><h2 id="managing-users" tabindex="-1"><a class="header-anchor" href="#managing-users" aria-hidden="true">#</a> Managing Users</h2><p>You can manage portal using <code>kc.eportal user</code> utility:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>usage: kc.eportal user [-h] [-a] [-c] [-d] [-p PASSWORD] [-r {admin,readonly}] [--note NOTE] [user]

list available users by default

positional arguments:
  user                  user name

optional arguments:
  -h, --help            show this help message and exit
  -a                    action: add new user
  -c                    action: change user
  -d                    action: delete user
  -p PASSWORD, --password PASSWORD
  -r {admin,readonly}, --role {admin,readonly}
  --note NOTE           description
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>To add a user:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal user -a -p AdminPassword admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To change user&#39;s password:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal user -c -p NewPassword admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Set user as read-only:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal user -c -r readonly admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="authentication-using-ldap" tabindex="-1"><a class="header-anchor" href="#authentication-using-ldap" aria-hidden="true">#</a> Authentication using LDAP</h2><p>ePortal supports LDAP authentication via bind operation. Every user should have a DN with an ability to perform bind request. ePortal doesn&#39;t sync users so you don&#39;t need to set special DN/password to access LDAP server.</p><h3 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h3><p>LDAP configuration settings are available inside the <code>Settings / LDAP</code> navigation item.</p><h4 id="url" tabindex="-1"><a class="header-anchor" href="#url" aria-hidden="true">#</a> URL</h4><p>Specifies host, port, and protocol of the LDAP server to connect to.</p><p>Format: <code>&lt;scheme&gt;://&lt;host&gt;[:port][?params]</code></p><ul><li><strong>scheme</strong>: <ul><li><code>ldap</code>: a verified encrypted TLS connection, you can specify <code>tls=0</code> to use an insecure connection;</li><li><code>ldaps</code>: an SSL connection;</li></ul></li><li><strong>host</strong>: hostname or ip of your LDAP server;</li><li><strong>port</strong>: custom port, by default 389 for <code>ldap</code> and 636 for <code>ldaps</code> scheme;</li><li><strong>params</strong>: <ul><li><code>strict_check=0</code>: enable/disable strict SSL certificate verification (enabled by default);</li><li><code>tls=0</code>: enable/disable TLS handshake on connect (enabled by default);</li><li><code>timeout=30</code>: LDAP server connection timeout (in seconds, 5 by default).</li></ul></li></ul><p>For example:</p><ul><li><code>ldap://ldap.forumsys.com?tls=0&amp;timeout=30</code>: use insecure connection with 30s connection timeout.</li></ul><h4 id="connection-string-dn-template" tabindex="-1"><a class="header-anchor" href="#connection-string-dn-template" aria-hidden="true">#</a> Connection String (DN template)</h4><p>Connection string is a DN template used in LDAP bind operation. All <code>%s</code> template placeholders will be replaced with the username from the login form. For example: <code>uid=%s,dc=example,dc=com</code></p><p>Some LDAP implementations support additional templates for bind requests:</p><ul><li>Active Directory accepts the <code>%s@example.com</code> template;</li><li><code>cn=%s,dc=example,dc=com</code> or <code>email=%s,dc=example,dc=com</code> can be also valid.</li></ul><h4 id="filter" tabindex="-1"><a class="header-anchor" href="#filter" aria-hidden="true">#</a> Filter</h4><p>Filter is an optional setting which specifies parameters for an additional LDAP search request to limit users who have access to ePortal. Usually it is a check of a group a user belongs to. If the search returns a non-empty result the user will be considered authenticated.</p><p>Format: <code>&lt;base&gt;??&lt;scope&gt;?&lt;filter&gt;</code>, is a part of <a href="https://tools.ietf.org/html/rfc2255" target="_blank" rel="noopener noreferrer">The LDAP URL Format RFC</a></p><ul><li><strong>base</strong>: a search base, a root node to perform search from;</li><li><strong>scope</strong>: a search scope; <ul><li><code>base</code>: search only for base (default);</li><li><code>one</code>: search for direct ascendants only (one level deep from base);</li><li><code>sub</code>: search in whole tree;</li></ul></li><li><strong>filter</strong>: search filter to apply.</li></ul><p>For example: <code>dc=example,dc=com??one?(&amp;(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))</code></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can use a <code>%s</code> placeholder in the <code>Filter</code> setting as well. It will be replaced with the username from the login form.</p></div><h3 id="login-process" tabindex="-1"><a class="header-anchor" href="#login-process" aria-hidden="true">#</a> Login process</h3><p>When a user logs in to ePortal, ePortal checks the user credentials in the local database at first. If the credentials are found, the user will be authenticated, and only if the user credentials are not found, ePortal redirects to LDAP.</p><p>When you log in to ePortal with your LDAP credentials for the first time, a user with LDAP username, read-only permissions, and <code>LDAP</code> description is created in the database by default (<code>https://&lt;eportal&gt;/admin/user/</code>).</p><p>In the picture, you can see one user created with <code>kc.eportal</code> command line interface and two users logged in with LDAP credentials:</p><p><img src="/images/eportalLDAPusers.png" alt="ldap users"></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>All fresh LDAP users have read-only permissions. You can set admin rights on <code>User edit</code> page by turning off <code>Readonly</code> field.</p></div><h3 id="basic-setup-example" tabindex="-1"><a class="header-anchor" href="#basic-setup-example" aria-hidden="true">#</a> Basic setup example</h3><p>The following examples are based on the public test LDAP server <a href="https://www.forumsys.com/tutorials/integration-how-to/ldap/online-ldap-test-server/" target="_blank" rel="noopener noreferrer">ldap.forumsys.com</a></p><p>Here is a list of our users:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b &#39;dc=example,dc=com&#39; &#39;(objectClass=person)&#39; dn
dn: uid=tesla,dc=example,dc=com
dn: uid=gauss,dc=example,dc=com
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Basic setup only checks if the provided username/password can bind to your directory service. Note: all fresh users have read-only permission so you can safely allow them to login into eportal and set correct permissions individually.</p><p>For a basic setup you should fill <code>Url</code> and <code>Connection string</code> settings:</p><table><thead><tr><th>Setting</th><th>Value</th></tr></thead><tbody><tr><td>URL</td><td>ldap://ldap.forumsys.com?tls=0</td></tr><tr><td>Connection string</td><td>uid=%s,dc=example,dc=com</td></tr></tbody></table><p>After that you can login using <code>gauss:password</code> or <code>tesla:password</code> credentials.</p><h3 id="filter-setup-example" tabindex="-1"><a class="header-anchor" href="#filter-setup-example" aria-hidden="true">#</a> Filter setup example</h3><p>Filter allows you to limit a set of users permitted to login into ePortal, for example users belonging to the <code>mathematicians</code> group.</p><p>Here are our example groups:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b &#39;dc=example,dc=com&#39; &#39;(objectClass=groupOfUniqueNames)&#39; dn
dn: ou=mathematicians,dc=example,dc=com
dn: ou=scientists,dc=example,dc=com
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And <code>mathematicians</code> group attributes:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ ldapsearch -H ldap://ldap.forumsys.com -LLL -x -b &#39;dc=example,dc=com&#39; &#39;(ou=mathematicians)&#39;
dn: ou=mathematicians,dc=example,dc=com
uniqueMember: uid=euclid,dc=example,dc=com
uniqueMember: uid=riemann,dc=example,dc=com
uniqueMember: uid=euler,dc=example,dc=com
uniqueMember: uid=gauss,dc=example,dc=com
uniqueMember: uid=test,dc=example,dc=com
ou: mathematicians
cn: Mathematicians
objectClass: groupOfUniqueNames
objectClass: top
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ePortal LDAP settings to limit allowed users:</p><table><thead><tr><th>Setting</th><th>Value</th></tr></thead><tbody><tr><td>URL</td><td>ldap://ldap.forumsys.com?tls=0</td></tr><tr><td>Filter</td><td>dc=example,dc=com??one?(&amp;(ou=mathematicians)(uniqueMember=uid=%s,dc=example,dc=com))</td></tr><tr><td>Connection string</td><td>uid=%s,dc=example,dc=com</td></tr></tbody></table><p>The filter idea is to find the <code>mathematicians</code> group which has an attribute <code>uniqueMember</code> equal to DN of our user who tries to login. After that you can login using <code>gauss:password</code> but not <code>tesla:password</code> credentials.</p><h2 id="accessing-eportal" tabindex="-1"><a class="header-anchor" href="#accessing-eportal" aria-hidden="true">#</a> Accessing ePortal</h2><p>To access KernelCare.eportal management console, connect to <strong>http://YOUR_IP/admin</strong> and enter your login &amp; password.</p><p><img src="/images/access_eportal.png" alt="login screen"></p><p>You can manage your login information using the <a href="#managing-users">kc.eportal tool</a></p><h2 id="patchset-deployment" tabindex="-1"><a class="header-anchor" href="#patchset-deployment" aria-hidden="true">#</a> PatchSet deployment</h2><p>ePortal has a built-in mechanism to download the latest patches. To start using it, click the <em>Settings</em> link in the ePortal navigational bar and then click <em>Patch Source</em>. To get access, please contact <a href="mailto:sales@tuxcare.com">sales@tuxcare.com</a> and request your ePortal access credentials.</p><p><img src="/images/eportal-edit-patch-source.png" alt="patch source"></p><p>You can choose only a limited set of distros to fetch to reduce disk space and network bandwidth requirements. Once you set up patch source access info, you will get to a list of available patchsets.</p><p><img src="/images/eportal-dashboard.png" alt="dashboard"></p><ul><li><p><strong>Usage</strong>: amount of servers using particular patchset on any feed. You can click on the number to see a list of servers using the patchset.</p></li><li><p><strong>Patchsets</strong>: name of the patchset. Click on a name will show patchset changelog.</p></li><li><p><strong>Feed name</strong>: cells show patchset deployment and server usage status on particular feed. Numbers are also clickable to filter server list.</p></li><li><p><strong>Manage</strong>: opens dialog to enable/disable the patchset.</p></li></ul><h3 id="manage-patchset-page" tabindex="-1"><a class="header-anchor" href="#manage-patchset-page" aria-hidden="true">#</a> Manage patchset page</h3><p><img src="/images/eportal-manage.png" alt="manage patchsets"></p><p>In this dialog you can control which patchsets will be enabled/disabled on corresponding feeds.</p><ul><li><p><strong>Enable all up to this patchset</strong>: action will enable all patchsets (excluding <strong>disabled</strong>) up to this patchset.</p></li><li><p><strong>Enable</strong>: action will enable only current patchset.</p></li><li><p><strong>Disable</strong>: action will disable only current patchset. Disabled patchsets are immune to auto-update and mass-enabling via <strong>Enable all up to this patchset</strong> action.</p></li></ul><p>To unroll a patchset from the CLI, run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal --unroll 16012017_1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="automatic-updates" tabindex="-1"><a class="header-anchor" href="#automatic-updates" aria-hidden="true">#</a> Automatic updates</h3><p>You can configure automatic updates by enabling Autoupdate on the desired feeds via Settings -&gt; Feeds.</p><div class="danger custom-block"><p class="custom-block-title">Note</p><p>The <strong>default feed</strong> cannot be configured via the Settings page to receive automatic updates. See the next section on configuring automatic updates for the <strong>default feed</strong>.</p></div><h3 id="automatic-updates-on-default-feed" tabindex="-1"><a class="header-anchor" href="#automatic-updates-on-default-feed" aria-hidden="true">#</a> Automatic updates on default feed</h3><p>It is possible to configure automatic updates on the <strong>default feed</strong> by creating a cron job. The following commands can be used to receive these updates.</p><p>The command below determines if the latest patches are available and installs them to the <strong>default feed</strong>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal --get-latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="script-to-deploy-release-from-a-file" tabindex="-1"><a class="header-anchor" href="#script-to-deploy-release-from-a-file" aria-hidden="true">#</a> Script to deploy release from a file</h3><p>If you have no opportunity to connect your ePortal server to the KernelCare patch server to download patchsets directly from it, you can do it manually.</p><p>If you have a location with already downloaded patchsets, and would like to identify the latest patchset file to be moved, you can compare the lists of archives you have with the content of the <code>/usr/share/kcare-eportal/arch/</code> folder.</p><p>After that, upload the selected patchsets to your ePortal server and run the <code>kc.eportal --deploy</code> command for each of them.</p><h4 id="example" tabindex="-1"><a class="header-anchor" href="#example" aria-hidden="true">#</a> Example</h4><p>Lets find out the difference between a test and a production ePortal instances:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ comm -23 \
    &lt;(ssh eportal-test &quot;ls /usr/share/kcare-eportal/arch/K*.tar.bz2&quot; | sort -h) \
    &lt;(ssh eportal-prod &quot;ls /usr/share/kcare-eportal/arch/K*.tar.bz2&quot; | sort -h) | tee patchsets.diff
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Upload patchsets to the production:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ cat patchsets.diff | xargs -Phav {} rsync -iv eportal-test:{} /tmp/
$ rsync -Phav /tmp/K*.tar.bz2 eportal-prod:/tmp/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Run the deployment tool with patchset file name as a parameter:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ ssh eportal-prod &#39;ls /tmp/K*.tar.bz2 | sort -h | xargs -n1 kc.eportal kcare deploy&#39;
2021-12-02 01:25:06,555 - eportal.patches - INFO - K04082020_1 was enabled in main
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="danger custom-block"><p class="custom-block-title">Note</p><p>Please note that procedure above should be done for all other types of patchsets (like libcare and qemu) <em>separately</em>. Use corresponding file prefixes and commands like <code>kc.eportal libcare deploy</code>.</p></div><h3 id="clean-obsolete-releases" tabindex="-1"><a class="header-anchor" href="#clean-obsolete-releases" aria-hidden="true">#</a> Clean obsolete releases</h3><p>The list of provided patches is reduced once in a month (old patches that have newer versions are removed), but resources are not deleted from ePortal machine. The control of resource deletion is in charge of the ePortal administrator. To free disk space on ePortal old release resources could be removed.</p><p>To check what releases will be removed:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># DRY_RUN=1 kc.eportal --clean-releases
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To remove obsolete releases:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal --clean-releases
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="libcare-patchset-deployment" tabindex="-1"><a class="header-anchor" href="#libcare-patchset-deployment" aria-hidden="true">#</a> LibCare PatchSet Deployment</h2><p>Starting from version 1.18, ePortal supports the LibCare patchset management. It is accessible from the <code>Patches / LibCare</code> navigation item. LibCare patches use the same Patch Source credentials, and you don&#39;t need to perform additional configuration.</p><p><img src="/images/eportal-libcare-feed.png" alt="libcare feed"></p><h3 id="disable-arbitrary-patchset" tabindex="-1"><a class="header-anchor" href="#disable-arbitrary-patchset" aria-hidden="true">#</a> Disable arbitrary patchset</h3><p>To disable a patchset, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>kc.eportal kcare unroll K20210129_02
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>If you want to remove a patches instead of disabling them, you can use the <code>--delete</code> option:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>kc.eportal kcare unroll K20210129_02 --delete
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="cli-to-install-the-latest-patchsets" tabindex="-1"><a class="header-anchor" href="#cli-to-install-the-latest-patchsets" aria-hidden="true">#</a> CLI to install the latest patchsets</h3><p>To update the default feed, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal libcare update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To update the <code>test</code> feed, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal libcare update --feed test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To update all auto-feeds, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal libcare auto-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="cli-to-deploy-patchset-from-archive" tabindex="-1"><a class="header-anchor" href="#cli-to-deploy-patchset-from-archive" aria-hidden="true">#</a> CLI to deploy patchset from archive</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ kc.eportal libcare deploy --help
usage: kc.eportal libcare deploy [-h] [--feed FEED] [--disabled] archive

positional arguments:
  archive      path to archive

optional arguments:
  -h, --help   show this help message and exit
  --feed FEED  feed to deploy archive to
  --disabled   do not enable patchset after deploy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For example:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal libcare deploy --feed test /tmp/U20210129_02.tar.bz2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This command will deploy and enable the <code>U20210129_02</code> patchset in to the <code>test</code> feed.</p><h2 id="qemu-patchset-deployment" tabindex="-1"><a class="header-anchor" href="#qemu-patchset-deployment" aria-hidden="true">#</a> QEMU PatchSet Deployment</h2><p>Starting from version 1.25, ePortal supports the QEMU patchset management. It is accessible from the <code>Patches / QEMUcare</code> navigation item. QEMU patches use the same Patch Source credentials, and you don&#39;t need to perform additional configuration.</p><p><img src="/images/eportal-qemu-feed.png" alt="qemu feed"></p><h3 id="command-to-install-the-latest-patchsets" tabindex="-1"><a class="header-anchor" href="#command-to-install-the-latest-patchsets" aria-hidden="true">#</a> Command to install the latest patchsets</h3><p>To update the default feed, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal qemu update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To update the <code>test</code> feed, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal qemu update --feed test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To update all auto-feeds, run the following command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal qemu auto-update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="command-to-deploy-patchset-from-archive" tabindex="-1"><a class="header-anchor" href="#command-to-deploy-patchset-from-archive" aria-hidden="true">#</a> Command to deploy patchset from archive</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ kc.eportal qemu deploy --help
usage: kc.eportal qemu deploy [-h] [--feed FEED] [--disabled] archive

positional arguments:
  archive      path to archive

optional arguments:
  -h, --help   show this help message and exit
  --feed FEED  feed to deploy archive to
  --disabled   do not enable patchset after deploy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For example:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal qemu deploy --feed test /tmp/U20210818_01-qemu.tar.bz2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This command will deploy and enable the <code>U20210818_01-qemu</code> patchset in to the <code>test</code> feed.</p><h2 id="managing-keys" tabindex="-1"><a class="header-anchor" href="#managing-keys" aria-hidden="true">#</a> Managing Keys</h2><p>To register new servers you need to create a KernelCare key that will be used for server registration. To go to the list of keys, click the <em>Keys</em> navigation item.</p><p><img src="/images/key-menu_zoom70.png" alt="keys"></p><ul><li>To edit a key, click <img src="/images/eportal_keys_edit.png" alt="edit keys">. The <em>Edit</em> tab opens.</li><li>To remove a key, click <img src="/images/eportal_keys_remove.png" alt="remove keys">. Please note, that removing the key would remove all servers under that key.</li><li>Click a key to go to Servers tab with the list of <a href="#managing-servers">servers registered</a> under that key. You can also remove servers on that tab.</li></ul><p>To create a new registration click <em>Create</em> tab.</p><p><img src="/images/key-creation_zoom70.png" alt="create key"></p><p>Fill in the following fields:</p><ul><li><strong>Key</strong> - you can provide a key value or leave the field empty, so an automatically generated key will be used</li><li><strong>Description</strong> - you can provide a description for the key</li><li><strong>Server Limit</strong> - the amount of servers that can be registered under that key</li><li><strong>Feed</strong> - select a specific feed or leave empty.</li><li><strong>Products</strong> - limit allowed products can be used with the key.</li></ul><p>Available products:</p><ul><li><strong>KernelCare</strong>/<strong>LibCare</strong>/<strong>QemuCare</strong>/<strong>DBCare</strong>: allow only patches of selected type.</li><li><strong>Enterprise Support for AlmaLinux - ESU</strong>: allow access to the Extended Security Updates and FIPS repositories.</li></ul><p>Products can be mixed to limit access to a particular set of patch types. For example:</p><ul><li><strong>KernelCare</strong> + <strong>LibCare</strong>: allow access only to kernel and lib patches.</li></ul><p>For Enterprise Support for AlmaLinux deployment instructions please see the <a href="#deploying-enterprise-support-for-almalinux">dedicated section</a></p><p>Click <em>Save</em> to add the key. The new registration key will be created and added to the list. The key itself will be used as a part of the registration command on an individual server.</p><p>Click <em>Save and Add Another</em> to save this key and add one more key.</p><p>Click <em>Save and Continue Editing</em> to add the key and open the key edit tab.</p><p>Click <em>Cancel</em> to return to the key list tab without adding a new key.</p><h3 id="cli-to-manage-keys" tabindex="-1"><a class="header-anchor" href="#cli-to-manage-keys" aria-hidden="true">#</a> CLI to manage keys</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ kc.eportal key --help
usage: kc.eportal key [-h] [-a] [-c] [--note NOTE] [--server-limit SERVER_LIMIT] [--feed FEED]
                      [--product {tuxcare-repo,db,kernel,libcare,qemu}] [--default-products]
                      [key]

list available keys by default

positional arguments:
  key                   key name

optional arguments:
  -h, --help            show this help message and exit
  -a                    action: add new key
  -c                    action: change key
  --note NOTE           key description
  --server-limit SERVER_LIMIT
                        maximum number of servers allowed
  --feed FEED           feed to associate key to
  --product {tuxcare-repo,db,kernel,libcare,qemu}
                        products available for the key, can be specified multiple times
  --default-products    set default product list (KernelCare, LibCare, DBCare, QEMUCare) for the key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>List keys:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Autogenerate key:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal key -a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Create key with specified value:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal key -a test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Set feed to key:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal key -c test --feed test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="managing-servers" tabindex="-1"><a class="header-anchor" href="#managing-servers" aria-hidden="true">#</a> Managing Servers</h2><p>You can see servers belonging to the key by clicking on the key itself in the <a href="#managing-keys">Managing Keys</a> interface.</p><p><img src="/images/server_list_1_zoom70.png" alt="server list"></p><p>The screen shows servers registered under the key, their IP, hostname, effective kernel as well as the time of registration and last check in.</p><p>To view the list of all servers IDs that are connected to the particular key, do the following:</p><ul><li>In the UI go to the page with the list of keys. Then click the particular key. The list of servers connected to this key will be displayed.</li></ul><p>To view the list of all servers IDs that are not connected to any key, use the <span class="notranslate"><em>Servers</em></span> button on the navigation bar.</p><p><img src="/images/eportal-servers.png" alt="eportal servers"></p><p>Also you can use CLI to see pairs of key/number of servers run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ kc.eportal --list-servers
Count | Key
----- + --------------------------------
    0 | 2shcolu7Y1x6885Q
    2 | 6J89aS44j6OmTr05
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="clean-inactive-servers" tabindex="-1"><a class="header-anchor" href="#clean-inactive-servers" aria-hidden="true">#</a> Clean inactive servers</h3><p>Servers inactive for more than 30 days can be removed using the followed command:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal server clean --inactive
2 servers were deleted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Clean-up of inactive servers can be performed automatically every day or rarer. To enable daily auto clean-up, you can add an option <code>CLEAN_INACTIVE_SERVERS_PERIOD = 3600 * 24</code> (value in seconds) in the <a href="#config-files">ePortal config file</a></p><h3 id="show-extended-check-in-statistics-in-admin-ui" tabindex="-1"><a class="header-anchor" href="#show-extended-check-in-statistics-in-admin-ui" aria-hidden="true">#</a> Show extended check-in statistics in admin UI</h3><p>A new table is added to the starting page. This table displays the following:</p><ul><li>Total number of servers.</li><li>Number of servers that checked in for the past 48 hours.</li></ul><p>The number of servers for each key is listed on the <em>Keys</em> page.</p><h2 id="managing-server-tags" tabindex="-1"><a class="header-anchor" href="#managing-server-tags" aria-hidden="true">#</a> Managing server tags</h2><p>You can use &#39;Server tags&#39; page to deal with tags.</p><p><img src="/images/tags_view.png" alt="server tags view"></p><p>Tagging is a convenient way to group servers by any criteria. For example OS, deployment environment, location, etc. You need to create a tag and then it can be assigned to a server from the <a href="#managing-servers">Managing Servers</a> interface.</p><p><img src="/images/tag_assignment.png" alt="tag assignment"></p><p>The tag may have an optional value. For example, this allows you to introduce a new geo location without creating a new tag for it.</p><h3 id="using-agent-cli-to-manage-tags" tabindex="-1"><a class="header-anchor" href="#using-agent-cli-to-manage-tags" aria-hidden="true">#</a> Using agent CLI to manage tags</h3><p>To add an extra Tag field for the server, run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kcarectl --tag command
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>where <code>command</code> is a parameter defined by a user. This parameter will be displayed in UI for the server. User could add multiple tags for each server. Each tag should be separated with <code>;</code> symbol.</p><p>Example:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kcarectl --tag &quot;env:prod;ubuntu&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This server has two tags : <code>env:prod</code> and <code>ubuntu</code>.</p><p><code>env:prod</code> is a parameter that has tag name <code>env</code> and the value <code>prod</code>.</p><p><img src="/images/addingextratagfield_zoom88.png" alt="tags"></p><p>To remove all tags from a particular server, run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kcarectl --tag &quot;&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Where <code>&quot;&quot;</code> is a parameter to delete the previously defined tag.</p><h2 id="feed-management" tabindex="-1"><a class="header-anchor" href="#feed-management" aria-hidden="true">#</a> Feed Management</h2><p>Feeds are intended to manage patchsets on the server, and they provide a possibility to bind a set of patches to a specific key. Possible use cases: for preliminary testing of patches, for applying updates to groups of servers with the similar hardware, etc.</p><p>To get into Feeds Management interface go to Settings -&gt; Feeds:</p><p><img src="/images/feed-button_zoom70.png" alt="feeds"></p><p>On this page a user can manage the existing feeds: create, delete, edit.</p><p><img src="/images/feed-menu_zoom70.png" alt="feed menu"></p><p>Available options:</p><ul><li><p>Name - a name of a feed.</p></li><li><p>Auto update - enable and disable automatic downloading of patches to this feed.</p></li><li><p>Deploy after X hours - a delay in hours between the moment the patchset is available for deployment and the moment it is installed to the feed.</p></li><li><p>Channel - a patch channel to use.</p><ul><li><strong>Stable</strong>: (default) stable patchsets marked with <code>eportal</code> label on <a href="https://patches.kernelcare.com/" target="_blank" rel="noopener noreferrer">the patch server</a>.</li><li><strong>Testing</strong>: all patchsets available on <a href="https://patches.kernelcare.com/" target="_blank" rel="noopener noreferrer">the patch server</a>.</li><li><strong>Unstable</strong>: patches from early-access feed (not recommended).</li></ul></li></ul><p>Every 10 minutes ePortal checks for new patches on the main patch server. If a new patch is available, it is uploaded to the ePortal server. Note: it is uploaded but is not deployed.</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>For information about configuring a client to periodically check and automatically download new patch sets, see <a href="#kernelcare-enterprise-client-config-file">client configuration</a></p></div><p>The patch availability time is considered starting from the moment a new patch appears on the ePortal, and that time is taken into account in <code>Deploy after X hours</code> option. So, if a user sets <code>Deploy after X hours = 10</code>, the patch will be deployed to the feed 10 hours after it has been downloaded to the ePortal server.</p><p>To make the feed auto-update immediately, so new patches are loaded to the feed immediately after they are available on ePortal, set <code>Deploy after X hours = 0</code>.</p><p>A special case is a clean installation when ePortal is installed on a new server (there aren&#39;t any downloaded archives with patches and feeds with deployed patchsets, including default feed). In this case, if a user creates a new feed and sets Deployed after X hours option right away, then all patches (from the oldest to the latest available) will be deployed to the feed after the specified X hours. This is because the archives are downloaded from scratch and will be considered as &quot;just appeared on ePortal&quot; - that is, all patches will have the same appearance time on ePortal from which the option Deploy after X hours will repel.</p><p><img src="/images/feedmanagement3_zoom70.png" alt="feed management"></p><p>On the main ePortal page, a user can set the corresponding key &lt;&gt; feed pair. This is done in the key creation interface or when editing a key.</p><p><img src="/images/feedmanagement4_zoom70.png" alt="edit key"></p><p>By default, a new key is bound to the default feed, alternatively, a user can choose a desired feed from the drop-down menu.</p><p><img src="/images/feedmanagement5_01_zoom70.png" alt="feed list"></p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>When removing a feed all keys attached to this feed will be moved to the default feed.</p></div><p><img src="/images/feedmanagement6_zoom70.png" alt="delete feed"></p><h3 id="cli-to-manage-feeds" tabindex="-1"><a class="header-anchor" href="#cli-to-manage-feeds" aria-hidden="true">#</a> CLI to manage feeds</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>~$ kc.eportal feed --help
usage: kc.eportal feed [-h] [-a] [-c] [--auto] [--no-auto] [--deploy-after hours]
                       [--channel {default,test}] [feed]

list available feeds by default

positional arguments:
  feed                  feed name

optional arguments:
  -h, --help            show this help message and exit
  -a                    action: add new feed
  -c                    action: change feed
  --auto                update feed automatically
  --no-auto             don&#39;t update feed automatically
  --deploy-after hours  deploy after specified hours
  --channel {default,test}
                        patchset channel to use for this feed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>List feeds:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ kc.eportal feed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Add auto updated feed:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal feed -a test --auto
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Change feed into delayed feed:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal feed -c test --deploy-after 12
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="api-keys-management" tabindex="-1"><a class="header-anchor" href="#api-keys-management" aria-hidden="true">#</a> API keys Management</h2><p>An API key may be used as an alternative to password authentication when accessing public API endpoints. API tokens provide a more secure way to authenticate APIs because they can be easily revoked without affecting each other, and you don&#39;t need to share your credentials.</p><p>To get into API keys Management interface go to Settings -&gt; API keys:</p><p><img src="/images/api_key_list.png" alt="API keys"></p><p>On this page a user can manage the existing API keys: create, revoke (delete).</p><p><img src="/images/api_key_create.png" alt="API key edit"></p><p>Available options:</p><ul><li>Key name - a name of the API key.</li><li>Expiration date - optional key expiration date.</li></ul><p>After generating the key, you will see a bar with a token, as in the picture below.</p><p><img src="/images/api_key_generated.png" alt="API key generated"></p><p>This token is not stored on the server, so you need to keep it in a safe place. Use this token in an API client as described in <a href="/eportal-api">ePortal API documentation</a>.</p><p>The API key is personal, meaning it is tied to a specific user and inherits their permissions. A user with read-only permissions can only manage their own keys, while an administrator has access to any user&#39;s API keys.</p><h2 id="how-to-setup-eportal-to-use-https" tabindex="-1"><a class="header-anchor" href="#how-to-setup-eportal-to-use-https" aria-hidden="true">#</a> How to setup ePortal to use HTTPS</h2><p>Some assumptions for a server where e-portal is deployed:</p><h3 id="terminate-tls-on-eportal-public-nginx-web-server" tabindex="-1"><a class="header-anchor" href="#terminate-tls-on-eportal-public-nginx-web-server" aria-hidden="true">#</a> Terminate TLS on ePortal public nginx web server</h3><ol><li>A firewall allows connections to 443 port.</li><li>Private and public keys are downloaded on the server.</li></ol><ul><li>Edit SSL configuration template according to your certificates:</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># mv /etc/nginx/eportal.ssl.conf.example /etc/nginx/eportal.ssl.conf
# vi /etc/nginx/eportal.ssl.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Include this configuration into the main one:</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># sed -e &#39;3iinclude eportal.ssl.conf;&#39; -i /etc/nginx/conf.d/eportal.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Restart nginx:</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># service nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="terminate-tls-on-external-balancer" tabindex="-1"><a class="header-anchor" href="#terminate-tls-on-external-balancer" aria-hidden="true">#</a> Terminate TLS on external balancer</h3><p>You can use any reverse proxy server of choice to terminate TLS traffic and forward requests to ePortal instance. The only requirement is to provide correct <code>Host</code> and <code>X-Forwarded-Proto</code> headers.</p><p>For example balancer nginx config:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>server {
   listen       443 ssl;
   server_name  your-eportal-domain;

   # ssl stuff ...
   # ssl_certificate  ...
   # ssl_certificate_key ...

   location / {
      proxy_pass http://eportal-instance-address;
      proxy_set_header Host $http_host;
      proxy_set_header X-Forwarded-Proto https;
   }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="update-agent-configuration" tabindex="-1"><a class="header-anchor" href="#update-agent-configuration" aria-hidden="true">#</a> Update agent configuration</h3><p>In order to communicate with e-portal, updated to https, you need to modify KernelCare configuration file on all the servers if they have IPs hard coded servers settings.</p><p>To do that, update <code>PATCH_SERVER</code> and <code>REGISTRATION_URL</code> options:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># vi /etc/sysconfig/kcare/kcare.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>So, after editing your <code>/etc/sysconfig/kcare/kcare.conf</code> should contain updated <code>PATCH_SERVER</code> and <code>REGISTRATION_URL</code> environment variables like in the example below:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PATCH_SERVER=https://eportal_domain_name/
REGISTRATION_URL=https://eportal_domain_name/admin/api/kcare
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>As an alternative you can use ePortal&#39;s special endpoint to update patch server address:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># curl -s https://eportal_domain_name/set-patch-server | bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="high-availability" tabindex="-1"><a class="header-anchor" href="#high-availability" aria-hidden="true">#</a> High availability</h2><p>Starting from version 1.28, ePortal supports application level replication. It allows to propagate changes in both ways – from a leader to followers and from followers to the leader.</p><p>Configuration settings related to replication and can be changed in <a href="#config-files">ePortal config file</a>:</p><ul><li><code>NODE_URL</code>: URL to the self instance, needed for auto-discovery purposes</li><li><code>LEADER_URL</code>: URL to the instance from where to fetch changes</li><li><code>REPLICATION_SHARED_KEY</code>: authorization key to access the replication data</li><li><code>REPLICATION_CHECK_CERT</code>: use strict TLS cert check for replication requests. It can be useful to deploy self signed certificates on replicas and get encrypted replication traffic without getting proper TLS certificate.</li><li><code>REPLICATION_CLEAN_AGE</code>: data age in seconds to leave during oplog cleanup. 7 days by default.</li><li><code>REPLICATION_CLEAN_AGGRESSIVE_AGE</code>: data age in seconds to leave during oplog cleanup for not-important operations. 1 hour by default.</li></ul><p>A leader node discovers followers automatically and after that fetches the changes.</p><p>You can use any convenient way to balance agent requests to the ePortal cluster. For example, you can add multiple IP addresses to the DNS name or use an HTTP balancer.</p><h3 id="basic-setup" tabindex="-1"><a class="header-anchor" href="#basic-setup" aria-hidden="true">#</a> Basic setup</h3><ol><li><p>Prepare two fresh ePortal instances and assign DNS name to IPs. For example:</p><ul><li>eportal1.corp -&gt; 192.168.1.11</li><li>eportal2.corp -&gt; 192.168.1.12</li><li>eportal.corp -&gt; 192.168.1.11, 192.168.1.12</li></ul></li><li><p>Let&#39;s choose <code>eportal1</code> as a leader and <code>eportal2</code> as a follower. <code>eportal.corp</code> is a cluster hostname to use on servers with KernelCare agent.</p><div class="danger custom-block"><p class="custom-block-title">Warning!</p><p>Please do not use a cluster hostname to perform operations with the ePortal admin UI.</p></div></li><li><p>On the <code>eportal1</code> define <code>NODE_URL</code> and <code>REPLICATION_SHARED_KEY</code> in the configuration file:</p></li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>NODE_URL = &#39;http://eportal1.corp&#39;
REPLICATION_SHARED_KEY = &#39;secret&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>On the <code>eportal2</code> define <code>NODE_URL</code>, <code>LEADER_URL</code> and <code>REPLICATION_SHARED_KEY</code>:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>NODE_URL = &#39;http://eportal2.corp&#39;
LEADER_URL = &#39;http://eportal1.corp&#39;
REPLICATION_SHARED_KEY = &#39;secret&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>That&#39;s it. After ePortal restart on both hosts, changes on the <code>eportal1</code> will be replicated to the <code>eportal2</code> instance and vice versa.</li></ol><div class="tip custom-block"><p class="custom-block-title">Note</p><p>You can change the KernelCare agent settings to point to a cluster hostname via:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># curl -s http://eportal.corp/set-patch-server | bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h3 id="adding-node-to-an-existing-eportal-instance" tabindex="-1"><a class="header-anchor" href="#adding-node-to-an-existing-eportal-instance" aria-hidden="true">#</a> Adding node to an existing ePortal instance</h3><p>If you already have a working ePortal instance, you can setup a second node, define <code>NODE_URL</code> and <code>LEADER_URL</code> on both instances and trigger full sync on the follower instance:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[root@eportal2.corp]$ kc.eportal replication --full-sync
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="monitoring" tabindex="-1"><a class="header-anchor" href="#monitoring" aria-hidden="true">#</a> Monitoring</h3><p>You can use <code>kc.eportal replication --short-status</code> CLI command to check replication status. It exits with code <code>1</code> if there are some issues with replication and outputs JSON:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;ok&quot;: true,       // overall health status
  &quot;lag&quot;: 1,         // overall replication lag in seconds
  &quot;last_sync&quot;: 1,   // overall sync delta in seconds (how many seconds ago was successful communication with an upstream)
  &quot;upstream&quot;: {     // per upstream metrics
    &quot;node2&quot;: {
      &quot;ok&quot;: true
      &quot;lag&quot;: 1,
      &quot;last_sync&quot;: 1,
    },
    &quot;node3&quot;: {
      &quot;ok&quot;: true
      &quot;lag&quot;: 1,
      &quot;last_sync&quot;: 1,
    }
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="other-replication-setups" tabindex="-1"><a class="header-anchor" href="#other-replication-setups" aria-hidden="true">#</a> Other replication setups</h3><p>For one leader and two follower setup:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>     +-&gt; leader &lt;-+
     |            |
     |            |
follower1       follower2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>there is a chance to lose a <code>leader</code> node and <code>follower1</code>/<code>follower2</code> will not communicate with each other. To mitigate this issue, you can deploy a ring replication:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>  +-&gt; node1 --+
  |           |
  |           v
node2 &lt;---- node3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where each instance follows another node.</p><h3 id="caveats" tabindex="-1"><a class="header-anchor" href="#caveats" aria-hidden="true">#</a> Caveats</h3><ol><li><p>Replication uses HTTP transport. If you deploy ePortal without SSL termination, the replication data will be transferred as-is unencrypted.</p></li><li><p>For a round-robin balancer setups (DNS or HTTP balancer round-robin) KernelCare agent can run onto replication lag in case of sequential registration and following update. You can introduce 10s timeout or repeat in your configuration management logic to mitigate the issue.</p></li><li><p>Replication log is kept for 7 days. If a node loses connectivity for more than 7 days it skips some changes.</p></li></ol><h2 id="deploying-kernelcare-enterprise" tabindex="-1"><a class="header-anchor" href="#deploying-kernelcare-enterprise" aria-hidden="true">#</a> Deploying KernelCare Enterprise</h2><p>You can find instructions to install KernelCare agent on http://your-eportal-domain/admin/docs/.</p><p>To install agent through ePortal you can use special endpoint <code>http://your-eportal-domain/install-kernelcare</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># export KCARE_MAILTO=admin@mycompany.com
# curl -s http://eportal.mycompany.com/install-kernelcare | bash
# kcarectl --register my-key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Exporting <code>KCARE_MAILTO</code> is an optional step, it helps to configure corresponding entry in <code>/etc/cron.d/kcare-cron</code> to receive all notifications related to failed KernelCare updates.</p><h3 id="kernelcare-enterprise-client-config-file" tabindex="-1"><a class="header-anchor" href="#kernelcare-enterprise-client-config-file" aria-hidden="true">#</a> KernelCare Enterprise client config file</h3><p>KernelCare Enterprise client configuration file is located in <code>/etc/sysconfig/kcare/kcare.conf</code></p><p>Example:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>AUTO_UPDATE=True
PATCH_SERVER=http://10.1.10.115/
REGISTRATION_URL=http://10.1.10.115/admin/api/kcare
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If <code>AUTO_UPDATE</code> set to <code>True</code>, KernelCare client will check in every 4 hours, and try to download and apply latest patches</p><p><code>PATCH_SERVER</code> - server from which patches will be downloaded</p><p><code>REGISTRATION_URL</code> - URL used to register/unregister server</p><h3 id="deployment-automation" tabindex="-1"><a class="header-anchor" href="#deployment-automation" aria-hidden="true">#</a> Deployment Automation</h3><p>It is possible to use automation tools like Ansible/Puppet/Chef/Salt to install and operate KernelCare on a big number of systems.</p><p>The deployment process includes:</p><ul><li>Running <code>http://your-eportal-domain/install-kernelcare</code> script. You can pre-download it (verify checksum) or directly execute <code>curl -s http://your-eportal-domain/install-kernelcare | bash</code>.</li><li>Registering KernelCare agents using an activation key</li></ul><h4 id="ansible" tabindex="-1"><a class="header-anchor" href="#ansible" aria-hidden="true">#</a> Ansible</h4><p>To start the automated deployment, you need to specify the following information:</p><ul><li><p>ePortal server name (or IP) in the <code>eportal_srv</code> Ansible variable. Other config file options can be found at <a href="/live-patching-services/#config-options" class="">Config Options</a> and <a href="#kernelcare-enterprise-client-config-file">KernelCare client config file</a> (ePortal).</p></li><li><p>an activation key in the <code>activation_key</code> Ansible variable. Activation keys can be generated in ePortal as described in <a href="#managing-keys">Managing Keys</a> (ePortal).</p></li></ul><p>Ansible playbook for deployment phase may look like:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>- hosts: kernelcare
  vars:
    eportal_srv: http://192.168.250.19
    activation_key: my-key
  tasks:
    - name: Download the installation shell script
      get_url:
        url: &quot;{{ eportal_srv }}/install-kernelcare&quot;
        dest: /root/kc-install.sh
        mode: &#39;0700&#39;

    - name: Run the installation shell script
      command: /root/kc-install.sh

    - name: register KernelCare agents
      command: /usr/bin/kcarectl --register {{ activation_key }}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ansible playbook file example for KernelCare agent removal:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>- hosts: kernelcare
  tasks:
    - name: unregister KernelCare agents
      command: /usr/bin/kcarectl --unregister
      ignore_errors: yes
      args:
        removes: /usr/bin/kcarectl

    - name: remove kernelcare package
      package:
        name: kernelcare
        state: absent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="changing-eportal-ip-domain" tabindex="-1"><a class="header-anchor" href="#changing-eportal-ip-domain" aria-hidden="true">#</a> Changing ePortal IP/domain</h3><p>You can change ePortal address at any moment by calling two special endpoints on hosts with KernelCare agent:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># curl -s http://your-eportal-domain/set-kernelcare-repo | bash
# curl -s http://your-eportal-domain/set-patch-server | bash
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>set-kernelcare-repo</code> configures new package repo to download agent updates through ePortal.</li><li><code>set-patch-server</code> configures new address of patch server.</li></ul><h2 id="deploying-enterprise-support-for-almalinux" tabindex="-1"><a class="header-anchor" href="#deploying-enterprise-support-for-almalinux" aria-hidden="true">#</a> Deploying Enterprise Support for AlmaLinux</h2><p>You can find instructions on how to set up <a href="https://docs.tuxcare.com/enterprise-support-for-almalinux/" target="_blank" rel="noopener noreferrer">Enterprise Support for AlmaLinux</a> on http://your-eportal-domain/admin/docs/</p><p>tuxctl is the setup tool for TuxCare&#39;s Extended Security Updates product for AlmaLinux. To set up <code>tuxctl</code> through ePortal you can use a special endpoint <strong>http://your-eportal-domain/install-tuxcare</strong>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># curl -s http://eportal.mycompany.com/install-tuxcare | bash
# tuxctl --license-key my-key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Where <code>my-key</code> should have the <code>Enterprise Support for AlmaLinux - ESU</code> product enabled.</p><h2 id="migrate-eportal" tabindex="-1"><a class="header-anchor" href="#migrate-eportal" aria-hidden="true">#</a> Migrate ePortal</h2><p>Here is a procedure to migrate feed/server/key configuration and patches data from one ePortal to another. ePortal version on a new host should be &gt;=1.18 and equal or greater than on an old host.</p><p>If you migrate from Debian-based to Debian-based system you can simply:</p><ul><li>Stop ePortal on both hosts.</li><li>Copy <code>/var/lib/eportal</code> to a new host. Note: directory owner must stay as <code>eportal:eportal</code>.</li><li>Copy config <code>/etc/eportal/config</code> if it exists.</li><li>Run migration <code>/usr/share/kcare-eportal/migratedb.py --upgrade</code> on a new host.</li><li>Start ePortal on a new host.</li></ul><p>Migration from RHEL-based distro is more elaborate. Later we refer to a <code>$BASE_DIR</code> variable in scripts. You can export it for RHEL-based distros:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># export BASE_DIR=/usr/share/kcare-eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>or for Debian-based distros:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># export BASE_DIR=/var/lib/eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>or for docker-based installation use corresponding data directory. For example if you run a container as <code>docker run -v /var/lib/eportal/data:/var/lib/eportal/data kernelcare/eportal</code> use /var/lib/eportal/data as <code>$BASE_DIR</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># export BASE_DIR=/var/lib/eportal/data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Stop ePortal on both hosts:</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>  [old-host ~]# systemctl stop eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>  [new-host ~]# systemctl stop eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>Remove db files on a new host:</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[new-host ~]# rm $BASE_DIR/*.sqlite*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Copy database files <code>$BASE_DIR/*.sqlite*</code> from an old host to a new host.</p></li><li><p>(Optional) copy runtime LDAP and Feed Source settings <code>$BASE_DIR/config/config.json</code>.</p></li><li><p>(Optional) copy ePortal web app settings <code>/usr/share/kcare-eportal/config/local.py</code> or for new ePortal <code>/etc/eportal/config</code> to <code>/etc/eportal/config</code> on a new host if it exists.</p></li><li><p>Copy <code>$BASE_DIR/instance-id</code> so our billing can know that the new ePortal was migrated and to avoid double billing.</p></li><li><p>Copy patch data <code>$BASE_DIR/{arch,resources,user-resources}</code> to a new host.</p></li><li><p>Set file owner. For RHEL-based distros:</p></li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[new-host ~]# chown -R nginx:nginx $BASE_DIR
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>For Debian-based distros:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[new-host ~]# chown -R eportal:eportal $BASE_DIR
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>Run migration <code>/usr/share/kcare-eportal/migratedb.py --upgrade</code> on a new host.</p></li><li><p>Start ePortal on the new host:</p></li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[new-host ~]# systemctl start eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="backup-and-restore" tabindex="-1"><a class="header-anchor" href="#backup-and-restore" aria-hidden="true">#</a> Backup and restore</h2><h3 id="create-backup" tabindex="-1"><a class="header-anchor" href="#create-backup" aria-hidden="true">#</a> Create backup</h3><p>kc.eportal utility have an option to create a data backup</p><p><code>kc.eportal backup &lt;path_to_archive&gt;</code> - creates an archive with a backup.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal backup /var/lib/eportal/backups/eportal_$(date &#39;+%Y-%m-%d&#39;).tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="restore-data-from-a-backup" tabindex="-1"><a class="header-anchor" href="#restore-data-from-a-backup" aria-hidden="true">#</a> Restore data from a backup</h3><div class="danger custom-block"><p class="custom-block-title">Warning!</p><p>IMPORTANT: ePortal should be stopped before restore process.</p></div><p>For example:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># systemctl stop eportal
# kc.eportal restore /var/lib/eportal/backups/eportal_backup.tar.gz
# kc.eportal kcare download-missing
# kc.eportal libcare download-missing
# kc.eportal qemu download-missing
# systemctl start eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>download-missing</code> commands ensure patchset state on disk corresponds with a state in db.</p><h2 id="config-files" tabindex="-1"><a class="header-anchor" href="#config-files" aria-hidden="true">#</a> Config files</h2><ul><li>ePortal config: <code>/etc/eportal/config</code>. Config for old versions (&lt;1.35): <code>/usr/share/kcare-eportal/local.py</code>.</li><li>Web Server (nginx) config: <code>/etc/nginx/conf.d/eportal.conf</code>.</li><li>Data directory: <code>/var/lib/eportal</code>.</li><li>Legacy data directory (RHEL based distros for old versions &lt;2.6): <code>/usr/share/kcare-eportal</code>.</li></ul><h2 id="stopping-starting" tabindex="-1"><a class="header-anchor" href="#stopping-starting" aria-hidden="true">#</a> Stopping &amp; starting</h2><p>To stop/start/reload/restart configuration of nginx server:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># systemctl stop|start|reload|restart nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>To stop/start/restart ePortal (Python):</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># systemctl stop|start|restart eportal
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="log-files" tabindex="-1"><a class="header-anchor" href="#log-files" aria-hidden="true">#</a> Log files</h2><p>ePortal log: <code>journalctl -u eportal</code></p><p>Nginx ePortal access log: <code>/var/log/nginx/access.log</code></p><p>Nginx error log: <code>/var/log/nginx/error.log</code></p><h3 id="log-rotation" tabindex="-1"><a class="header-anchor" href="#log-rotation" aria-hidden="true">#</a> Log rotation</h3><p>By default there is no predefined parameters for ePortal&#39;s logs rotation. If you want to enable it for the files listed above:</p><ul><li>Install <code>logrotate</code> package</li><li>Create/edit <code>/etc/logrotate.d/eportal</code> configuration file</li></ul><p>Example logrotate config:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/var/log/nginx/kcare-eportal.log {
    daily
    rotate 5 # keep 5 last archives
    missingok # it&#39;s ok if there is no such file
    notifempty # do nothing if file is empty
    compress
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nagios-zabbix-support" tabindex="-1"><a class="header-anchor" href="#nagios-zabbix-support" aria-hidden="true">#</a> Nagios &amp; Zabbix support</h2><p>KernelCare.ePortal since version 1.2 supports server monitoring similar to <a href="/kc-agent-monitoring/#nagios-plugin" class="">Nagios</a> &amp; <a href="/kc-agent-monitoring/#zabbix-template" class="">Zabbix</a> monitoring.</p><p>You can curl the API directly to receive the information:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>https://yourserver/admin/api/kcare/nagios/KCAREKEY
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>or you can use <a href="https://patches.kernelcare.com/downloads/nagios/check_kcare" target="_blank" rel="noopener noreferrer">https://patches.kernelcare.com/downloads/nagios/check_kcare</a> script by modifying KEY_KCARE_NAGIOS_ENDPOINT in it to point to your server (change <a href="https://cln.cloudlinux.com/clweb" target="_blank" rel="noopener noreferrer">https://cln.cloudlinux.com/clweb</a> (link to old UI) or <a href="https://cln.cloudlinux.com/console/auth/login" target="_blank" rel="noopener noreferrer">https://cln.cloudlinux.com/console/auth/login</a> (link to new UI) with <a href="https://yourserver/admin" target="_blank" rel="noopener noreferrer">https://yourserver/admin</a> ).</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Access using <code>PARTNER_LOGIN/TOKEN</code> is not supported by KernelCare.ePortal</p></div><h2 id="usage-reports" tabindex="-1"><a class="header-anchor" href="#usage-reports" aria-hidden="true">#</a> Usage reports</h2><p>In common case, usage reports are sending automatically but when it&#39;s not possible, ePortal will try to send report as an email. That requires configured Sendmail (SSMTP) on the host. You can find a short instruction below.</p><p>If mail sending attempt fails, ePortal will save the reports in <code>/usr/share/kcare-eportal/reports</code> which should be sent manually.</p><h3 id="how-to-configure-sendmail-ssmtp" tabindex="-1"><a class="header-anchor" href="#how-to-configure-sendmail-ssmtp" aria-hidden="true">#</a> How to configure Sendmail (SSMTP)</h3><p>First of all you need to install <code>ssmtp</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># yum install -y ssmtp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Edit <code>/etc/ssmtp/ssmtp.conf</code> file in accordance with your SMTP server configuration. Here is a simple config file describing a common way to connect to Gmail accounts:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root=username@gmail.com
mailhub=smtp.gmail.com:587
hostname=localhost
UseSTARTTLS=YES
AuthUser=username@gmail.com
AuthPass=xxxxxxxxxxxxxxxxxxx
FromLineOverride=YES
TLS_CA_File=/etc/ssl/certs/ca-certificates.crt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Actual location of a TLS_CA_Files depends on Linux distribution:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&quot;/etc/ssl/certs/ca-certificates.crt&quot;,                // Debian/Ubuntu/Gentoo etc.
&quot;/etc/pki/tls/certs/ca-bundle.crt&quot;,                  // Fedora/RHEL 6
&quot;/etc/ssl/ca-bundle.pem&quot;,                            // OpenSUSE
&quot;/etc/pki/tls/cacert.pem&quot;,                           // OpenELEC
&quot;/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem&quot;, // CentOS/RHEL 7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Also you could get if from:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># curl-config --ca
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Now you can test a connection:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>$ echo -n &#39;Subject: test\n\nTesting ssmtp&#39; | sendmail -v some-recipient@gmail.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="custom-environment-variables" tabindex="-1"><a class="header-anchor" href="#custom-environment-variables" aria-hidden="true">#</a> Custom environment variables</h2><p>You can define your own environment variables for ePortal process.</p><p>There is the <code>/usr/share/kcare-eportal/environment</code> folder, which is basically daemon tools compatible envdir.</p><p>For example, to disable the default https verification you can set the <code>PYTHONHTTPSVERIFY</code> environment variable to <code>0</code> as follows:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># echo 0 &gt; /usr/share/kcare-eportal/environment/PYTHONHTTPSVERIFY`
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="authentication-using-single-sign-on" tabindex="-1"><a class="header-anchor" href="#authentication-using-single-sign-on" aria-hidden="true">#</a> Authentication using Single Sign On</h2><p>ePortal supports Single Sign On authentication by &quot;OAuth 2.0&quot; standard, &quot;Authorization Code&quot; flow.</p><h3 id="sso-configuration" tabindex="-1"><a class="header-anchor" href="#sso-configuration" aria-hidden="true">#</a> SSO Configuration</h3><p>To enable SSO you need to configure OAuth2 authentication service provider and ePortal.</p><h4 id="okta-application-setup-example" tabindex="-1"><a class="header-anchor" href="#okta-application-setup-example" aria-hidden="true">#</a> Okta Application setup example</h4><p>You set up your OpenID Connect application inside the Okta Admin Console:</p><ol><li><p>In the Admin Console, go to <strong>Applications</strong> &gt; <strong>Applications</strong>.</p></li><li><p>Click <strong>Create App Integration</strong>.</p></li><li><p>On the Create a new app integration page, select <strong>OIDC - OpenID Connect</strong> for the <strong>Sign-in method</strong> and then select <strong>Web Application</strong> as the <strong>Application type</strong>.</p></li><li><p>Fill in the <strong>Application Settings</strong>.</p></li></ol><table><thead><tr><th><strong>Setting</strong></th><th><strong>Value</strong></th></tr></thead><tbody><tr><td>Sign-in redirect URI</td><td>http://eportal_ip/admin/sso/login/callback</td></tr><tr><td>Sign-out redirect URI</td><td>http://eportal_ip/admin/login</td></tr></tbody></table><ol start="5"><li>Obtain <em>Client ID</em>, <em>Client secret</em>, the full URL to the <code>/authorize</code>, <code>/token</code>, <code>/userinfo</code> endpoints.</li></ol><h4 id="eportal-setup" tabindex="-1"><a class="header-anchor" href="#eportal-setup" aria-hidden="true">#</a> ePortal setup</h4><p>On the ePortal machine, configure SSO settings.</p><p>Edit <a href="#config-files">ePortal config file</a>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>OIDC_AUTH_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/authorize&quot;
OIDC_TOKEN_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/token&quot;
OIDC_USERINFO_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/userinfo&quot;
OIDC_LOGOUT_URL=&quot;https://dev-61441893.okta.com/oauth2/v1/logout&quot;

OIDC_CLIENT_ID=&quot;0Aa134lzhUKj8jDMo5d7&quot;
OIDC_CLIENT_SECRET=&quot;AoBNuWRLRu2dxIR3Q0btO53N1entmGxBjQqwmjVL&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Restart ePortal (see the <a href="#stopping-starting">Stopping &amp; Starting</a> section, choose a corresponding OS).</p><p>If all settings configured correctly the new <strong>Sign In with SSO</strong> button has to appear on login page <code>http://eportal_ip/admin/login</code></p><p><img src="/images/sso_eportal.png" alt="sso eportal"></p><h2 id="custom-patches-storage" tabindex="-1"><a class="header-anchor" href="#custom-patches-storage" aria-hidden="true">#</a> Custom patches storage</h2><p>By default patches with databases are stored in <code>/usr/share/kcare-eportal</code> for RHEL-based systems and <code>/var/lib/eportal</code> for deb-based systems. You can configure it to use split storage, for example to keep patches on external block device.</p><p>Edit <a href="#config-files">ePortal config file</a>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PATCHES_DIR = &#39;/path/to/patches/storage&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal sync-nginx-conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>It initializes storage and makes corresponding modifications to nginx config to serve patches from a new place.</p><p>And restart <code>nginx</code> and <code>eportal</code> services to apply changes:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># systemctl restart eportal nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting" aria-hidden="true">#</a> Troubleshooting</h2><p>If you have any questions regarding setting up and operating ePortal, please reach out to the support team. To simplify the analysis of a problem, it is often necessary to provide additional information about the system environment. It is recommended to use the ePortal CLI to collect this information and submit it to support.</p><p>Run:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal doctor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>In order for the auto-submission to work, you need to configure patch source (see <a href="#patchset-deployment">PatchSet deployment</a>).</p><p>If you experience problems configuring the patch source or have problems accessing the Internet, you can generate a report and submit it manually.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># kc.eportal doctor --no-send
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The above command will create an archive with the collected data and output the path to it. You can inspect the contents of the archive if necessary and then send it to the support team.</p></div><div class="page-edit"><div class="edit-link"><img src="/global/pen.svg" alt="icon pen"><a href="https://github.com/cloudlinux/tuxcare-documentation/tree/master/docs/eportal/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div></div><div class="back-to-top" data-v-1eb13e00><a class="nav-arrow top back-to-top__link" data-v-1eb13e00><span class="back-to-top__link-span" data-v-1eb13e00>Scroll up</span></a></div><!--[--><!--]--></div><!----><div class="footer footer-default-layout" data-v-d0933a51><div class="footer__img" data-v-d0933a51><a href="https://tuxcare.com" data-v-d0933a51><img src="/global/we-are-cloudlinux.svg" data-v-d0933a51></a></div><div class="footer-company-title" data-v-d0933a51>2025. Cloud Linux Software Inc </div><div class="social" data-v-d0933a51><div class="social_links" data-v-d0933a51><!--[--><a href="https://cloudlinux.zendesk.com/hc/en-us/categories/360002375960-KernelCare" target="_blank" data-v-d0933a51>Knowledge base</a><a href="https://forum.cloudlinux.com/forum/tuxcare" target="_blank" data-v-d0933a51>Forum</a><a href="https://blog.tuxcare.com/" target="_blank" data-v-d0933a51>Blog</a><a href="https://www.cloudlinux.com/privacy-policy/" target="_blank" data-v-d0933a51>Privacy Policy</a><!--]--></div><span class="footer-social-text" data-v-d0933a51>Stay in touch</span><div class="social-icons-wrapper" data-v-d0933a51><!--[--><a class="social-icons-link" href="https://www.facebook.com/tuxcare/" target="_blank" data-v-d0933a51><img class="social-icons-link-img" src="/footer-social/fb.png" alt="footer logo" data-v-d0933a51></a><a class="social-icons-link" href="https://twitter.com/tuxcare_/" target="_blank" data-v-d0933a51><img class="social-icons-link-img" src="/footer-social/tw.png" alt="footer logo" data-v-d0933a51></a><a class="social-icons-link" href="https://linkedin.com/company/tuxcare" target="_blank" data-v-d0933a51><img class="social-icons-link-img" src="/footer-social/in.png" alt="footer logo" data-v-d0933a51></a><a class="social-icons-link" href="https://www.youtube.com/@TuxCare" target="_blank" data-v-d0933a51><img class="social-icons-link-img" src="/footer-social/ytube.png" alt="footer logo" data-v-d0933a51></a><!--]--></div></div></div></div><div id="bot-ui" data-v-20315ea7><!-- Conditionally show toggle button with highlight --><div class="toggle-container" style="" data-v-20315ea7><div class="pulse-ring" data-v-20315ea7></div><button class="chat-toggle" data-v-20315ea7><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="#ffffff" data-v-20315ea7><g id="SVGRepo_iconCarrier" data-v-20315ea7><path fill-rule="evenodd" clip-rule="evenodd" d="M8.48 4h4l.5.5v2.03h.52l.5.5V8l-.5.5h-.52v3l-.5.5H9.36l-2.5 2.76L6 14.4V12H3.5l-.5-.64V8.5h-.5L2 8v-.97l.5-.5H3V4.36L3.53 4h4V2.86A1 1 0 0 1 7 2a1 1 0 0 1 2 0 1 1 0 0 1-.52.83V4zM12 8V5H4v5.86l2.5.14H7v2.19l1.8-2.04.35-.15H12V8zm-2.12.51a2.71 2.71 0 0 1-1.37.74v-.01a2.71 2.71 0 0 1-2.42-.74l-.7.71c.34.34.745.608 1.19.79.45.188.932.286 1.42.29a3.7 3.7 0 0 0 2.58-1.07l-.7-.71zM6.49 6.5h-1v1h1v-1zm3 0h1v1h-1v-1z" data-v-20315ea7></path></g></svg></button><div class="highlight-container" data-v-20315ea7><div class="tooltip-text" data-v-20315ea7>Try our new Virtual Assistant!</div></div></div><!----></div><!--]--></div>
    <script type="module" src="/assets/app-6db1f508.js" defer></script>
  </body>
</html>
